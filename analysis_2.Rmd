---
title: "analysis_2"
author: "Eden Deng, Jane Zhang, Shari Tian"
date: "11/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Packages

```{r load_data, warning = FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(foreign)
library(naniar)
library(mlmi)
library(glmnet)
library(bayesm)

```

# Load Data

```{r}

taiwan_orig <- read.csv("probit_taiwan_data.csv")
taiwan_orig <- taiwan_orig %>%
  select(-X)
```

# Data Imputation

```{r impute}
miss_var_summary(taiwan_orig)

pct_miss(taiwan_orig)

vis_miss(taiwan_orig)

mcar_test(taiwan_orig)

#taiwan_impute <- catImp(taiwan_orig, M=1, pd=TRUE, steps = 500, type=3, rseed=4423)
#names(taiwan_impute) <- names(taiwan_orig)

# rename variables
# taiwan <- data.frame("Gender" = factor(taiwan_impute$se002, ordered = TRUE), "Age" = factor(taiwan_impute$se003, ordered = TRUE), "Education" = factor(taiwan_impute$se005, ordered = TRUE), "Income" = factor(taiwan_impute$se009, ordered = TRUE), "PolInterest" = factor(taiwan_impute$q056, ordered = TRUE), "DemSat" = factor(taiwan_impute$q098, ordered = TRUE), "Vote" = factor(taiwan_impute$q027, ordered = TRUE), "UnderstandPol" = factor(taiwan_impute$q127, ordered = TRUE), "TrustGov" = factor(taiwan_impute$q131, ordered = TRUE))

#write.table(taiwan, "probit_taiwan_imputed.dat")

taiwan <- read.table("probit_taiwan_imputed.dat")

# factor variables
taiwan[colnames(taiwan)] <- lapply(taiwan[colnames(taiwan)], factor)
```

# Probit Regression Model

```{r}
model <- glm(Vote ~ ., family = binomial(link = "probit"), 
    data = taiwan)

summary(model)
```
# Bayesian Probit

```{r}
y <- c(taiwan$Vote)
y <- replace(y, y == 1, 0)
y <- replace(y, y == 2, 1)
```


```{r}
gender <- c(taiwan$Gender)
age <- c(taiwan$Age)
education <- c(taiwan$Education)
income <- c(taiwan$Income)
polinterest <- c(taiwan$PolInterest)
demsat <- c(taiwan$DemSat)
understandpol <- c(taiwan$UnderstandPol)
trustgov <- c(taiwan$TrustGov)
```

```{r}
X<-cbind(gender,age,education, income,polinterest,demsat,understandpol,trustgov)
betabar <- rep(0, nrow(X))
A <- (1/nrow(X))*t(X)%*%X
R <- 10000
keep <- 1
nprint <- 0
```

```{r}
Data <- list(y=y, X=X)
Prior <- list(A=A)
Mcmc <- list(R=R, keep=keep, nprint=nprint)
```


```{r}
out <- rbprobitGibbs(Data, Prior, Mcmc)
```

```{r}
betas <- out$betadraw
```


```{r}
ci_b2 <- quantile(betas[,2], c(0.025, 0.975))
ggdensity(betas[,2], title = "Density of Coefficient for Age", xlab = FALSE, fill = "lightgray",
   add = "mean", rug = TRUE) +
  geom_vline(xintercept = ci_b2[1], linetype = "dashed", color = "red") +
  geom_vline(xintercept = ci_b2[2], linetype = "dashed", color = "red")
```
```{r}
ci_b4 <- quantile(betas[,4], c(0.025, 0.975))
ggdensity(betas[,4], title = "Density of Coefficient for Income", xlab = FALSE, fill = "lightgray",
   add = "mean", rug = TRUE) +
  geom_vline(xintercept = ci_b4[1], linetype = "dashed", color = "red") +
  geom_vline(xintercept = ci_b4[2], linetype = "dashed", color = "red")
```

```{r}
ci_b5 <- quantile(betas[,5], c(0.025, 0.975))
ggdensity(betas[,5], title = "Density of Coefficient for Political Interest", xlab = FALSE, fill = "lightgray",
   add = "mean", rug = TRUE) +
  geom_vline(xintercept = ci_b5[1], linetype = "dashed", color = "red") +
  geom_vline(xintercept = ci_b5[2], linetype = "dashed", color = "red")

```
